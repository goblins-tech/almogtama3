<!--
todo:

- *ngIf="data$ | async as data && data.payload && data.payload.length>0; else noContent"
https://stackoverflow.com/questions/59432362/angular-ngif-data-async-as-data-data-payload-else-nocontent

- item.id = item.shortId || item._id (use pref.keys to adjust keys)

-prefrencess
<content-view pref={slug:[200,':ar'], keys:{'id':'shortId|_id'}}></content-view>

-   as of angular 9 @ngx-share/buttons has an issue: Cannot read property 'shareButton' of undefined
  https://github.com/MurhafSousli/ngx-sharebuttons/issues/429#issuecomment-583906237
  so we temporary stopped <share-buttons>

- item.link = {{item.category}}/{{item.id}}-{{item | slug:200:':ar' }}
- item.cover = {{item.type}}/{{item.id}}/{{item.cover}}
- pref.back = /{{item.category || ''}} ; the default link to be shown when there is no content
  also use pref.noContent to show a custom message
 -->
<ng-container *ngIf="data; else loading">
  <ng-container
    *ngIf="(data.type=='item' && data.payload) || (data.type=='list' && data.payload?.length>0); else noContent"
  >
    <!-- data.payload:[]|{}, so in case of type=='item' don't use data.payload?.length>0 -->

    <ng-container
      *ngTemplateOutlet="!data.payload?noContent:data.type=='item'?itemBlock:pref.layout=='list'?listBlock:gridBlock; context:{data:data}"
    ></ng-container>
  </ng-container>
</ng-container>

<ng-template let-item="data.payload" #itemBlock>
  <mat-card>
    <mat-card-header>
      <div *ngIf="item.avatar" mat-card-avatar>
        <img src="{{item.avatar}}" />
      </div>
      <mat-card-title dir="auto">
        <a href="{{item.link || '#'}}"
          >{{item.title | length:200}}</a
        ></mat-card-title
      >
      <mat-card-subtitle dir="auto"
        >{{item.subtitle | length:200}}</mat-card-subtitle
      >
    </mat-card-header>
    <img
      mat-card-image
      *ngIf="item.cover"
      lazyLoad="{{item.cover}}"
      alt="{{item.title}}"
    />

    <!-- it is recommended to render the contet that was generated via <quill-editor> inside <quill-view>
    https://www.npmjs.com/package/ngx-quill#quillviewcomponent---using-quilljs-to-render-content

    <mat-card-content
      dir="auto"
      innerHtml="{{item.content | content}}"
    ></mat-card-content> -->
    <mat-card-content dir="auto"
      ><quill-view
        #quillView
        [content]="item.content"
        format="text"
        theme="snow"
      ></quill-view
    ></mat-card-content>
    <!-- todo: use content[] to add content segments, ex: for jobs we need to add: expiration alert -> content -> contacts -->
    <mat-card-actions>
      <!--
      <share-buttons show="5"></share-buttons>
    -->
    </mat-card-actions>
  </mat-card>
</ng-template>

<ng-template #gridBlock let-data="data.payload">
  <div class="masonry">
    <mat-card class="masonry-item" *ngFor="let item of data">
      <mat-card-header>
        <div *ngIf="item.avatar" mat-card-avatar>
          <img src="{{item.avatar}}" />
        </div>
        <mat-card-title dir="auto"
          ><a href="{{item.link || '#'}}">{{item.title}}</a></mat-card-title
        >
        <mat-card-subtitle dir="auto">{{item.subtitle}}</mat-card-subtitle>
      </mat-card-header>
      <img
        mat-card-image
        *ngIf="item.cover"
        lazyLoad="{{item.cover}}"
        alt="{{item.title}}"
      />
      <mat-card-content
        dir="auto"
        [innerHtml]="item.content | summary"
      ></mat-card-content>
      <!-- <mat-card-actions>
        <button mat-flat-button color="primary">
          <mat-icon>like</mat-icon> Like
        </button>
        <button mat-flat-button color="accent">
          <mat-icon>share</mat-icon> SHARE
        </button>
      </mat-card-actions> -->
    </mat-card>
  </div>
</ng-template>

<ng-template #listBlock let-data="data.payload">
  <mat-list>
    <mat-list-item *ngFor="let item of data">
      <h4 mat-line dir="auto">
        <a href="{{item.link || '#'}}">{{item.title | length:200}}</a>
      </h4>
      <h6 mat-line dir="auto">{{item.subtitle | length:200}}</h6>
      <div mat-line [innerHtml]="item.content | summary" dir="auto"></div>
      <!-- todo: add cancel btn -->
    </mat-list-item>
  </mat-list>
</ng-template>

<ng-template #noContent dir="auto"
  >{{pref.noContent || 'No content!'}} <br />
  <a href="{{pref.back || '/'}}">Back</a></ng-template
>

<ng-template #loading dir="auto">Loading ....</ng-template>
